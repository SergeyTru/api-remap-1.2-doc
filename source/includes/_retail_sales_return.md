## Документ Розничный возврат
Средствами JSON API можно создавать и обновлять сведения о Розничных возвратах, запрашивать списки Розничных возвратов и сведения по отдельным Розничным возвратам. Позициями Розничных возвратов  можно управлять как в составе отдельного Возврата, так и отдельно - с помощью специальных ресурсов для управления позициями Розничного возврата. Кодом сущности для Розничного возврата в составе JSON API является ключевое слово **retailsalesreturn**.
### Розничные возвраты 
#### Атрибуты сущности
+ **meta** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о Розничном возврате
+ **id** - ID в формате UUID `Только для чтения`
+ **accountId** - ID учетной записи `Только для чтения`
+ **syncId** - ID синхронизации. После заполнения недоступен для изменения.
+ **updated** - Момент последнего обновления сущности `Только для чтения`
+ **deleted** - Момент последнего удаления сущности `Только для чтения`
+ **name** - номер Розничного возврата
+ **description** - Комментарий Розничного возврата
+ **externalCode** - Внешний код Розничного возврата
+ **moment** - Дата Розничного возврата
+ **applicable** - Отметка о проведении
+ **vatEnabled** - Учитывается ли НДС
+ **vatIncluded** - Включен ли НДС в цену
+ **sum** - Сумма Розничного возврата в копейках `Только для чтения`
+ **rate** - Валюта
+ **owner** - Ссылка на Владельца (Сотрудника) в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **shared** - Общий доступ
+ **group** - Отдел сотрудника в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **organization** - Ссылка на ваше юрлицо в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **agent** - Ссылка на контрагента в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **store** - Ссылка на склад в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **contract** - Ссылка на договор в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **project** - Ссылка на проект в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **state** - Статус Розничного возврата в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **organizationAccount** - Ссылка на счёт вашего юрлица в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **agentAccount** - Ссылка на счёт контрагента в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **attributes** - Коллекция доп. полей в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
<br>Поля при expand'е:</br>
  - **name** - номер документа
  - **moment** - дата печати
  - **href** - ссылка на файл печатной формы
  - **fileName** - название файла печатной формы
  - **updated** - дата последнего изменения
+ **created** - Дата создания `Только для чтения`
+ **vatSum** - Сумма НДС `Только для чтения`
+ **positions** - Ссылка на позиции Розничного возврата в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **demand** - Ссылка на Розничную продажу, по которой произошёл возврат в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные). Поле является необходимым для возврата на основании.
+ **retailStore** - Ссылка на точку продаж в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **retailShift** - Ссылка на Розничную смену, в рамках которой была проведена продажа в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные) `Необходимое`
+ **cashSum**  - Оплачено наличными. Поле является необходимым для возврата без основания
+ **noCashSum** - Оплачено картой. Поле является необходимым для возврата без основания


#### Позиции Розничного возврата
Позиции Розничного возврата - это список товаров/услуг/модификаций/серий.
Объект позиции Розничного возврата содержит следующие поля:
+ **id** - ID товара в формате UUID `Только для чтения`
+ **accountId** - ID учетной записи `Только для чтения`
+ **quantity** - Количество товаров/услуг данного вида в позиции. Если позиция - товар, у которого включен учёт по серийным номерам, то значение в этом поле всегда будет равно количеству серийных номеров для данной позиции в документе.
+ **price** - Цена товара/услуги в копейках
+ **discount** - Процент скидки или наценки. Должен совпадать с указанным в продаже (игнорируется для возврата без основания)
+ **vat** - НДС, которым облагается текущая позиция
+ **assortment** - Ссылка на товар/услугу/серию/модификацию, которую представляет собой позиция, в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **pack** - Упаковка товара
+ **cost** - Себестоимость за единицу в копейках. Можно задать только для розничных возвратов без основания.
+ **things** - Серийные номера
Значение данного атрибута игнорируется, если товар позиции не находится на серийном учете.
В ином случае количество товаров в позиции будет равно количеству серийных номеров, переданных в значении атрибута.

С позициями можно работать с помощью специальных [ресурсов для управления позициями Розничного возврата](#документ-розничный-возврат-позиции-розничного-возврата),
а также в составе отдельного Розничного возврата. При работе в составе отдельного Розничного возврата,
вы можете отправлять запросы на создание отдельного Розничного возврата с включенным в тело запроса
массивом позиций Розничного возврата. Если количество позиций превышает максимально допустимое, то для
дальнейшего пополнения позиций нужно будет работать со специальным ресурсом "Позиции Розничного возврата".
Также, при работе в составе отдельного Розничного возврата, можно отправлять запросы на обновление списка позиций
с включенным в тело запроса массивом позиций Розничного возврата. При этом важно помнить, что коллекция позиций будет
восприниматься как "все позиции Розничного возврата" и полностью заменит уже существующую коллекцию при обновлении объекта - лишние
позиции будут удалены, новые добавлены, существующие - изменены.

О работе с доп. полями Розничных возвратов можно прочитать [здесь](/api/remap/1.2/doc/index.html#header-работа-с-дополнительными-полями)

### Получить Розничные возвраты 
Запрос всех Розничных возвратов на данной учётной записи.
Результат: Объект JSON, включающий в себя поля:
- **meta** [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о выдаче,
- **context** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о сотруднике, выполнившем запрос.
- **rows** - Массив JSON объектов, представляющих собой Розничные возвраты.

**Параметры**

| Параметр                | Описание  |
| ------------------------------ |:---------------------------|
|limit |  `number` (optional) **Default: 1000** *Example: 1000* Максимальное количество сущностей для извлечения.`Допустимые значения 1 - 1000`.|
|offset |  `number` (optional) **Default: 0** *Example: 40* Отступ в выдаваемом списке сущностей.|

> Получить Розничные возвраты

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка Розничных возвратов.

### Создать Розничный возврат 
Розничная смена, на которую указывает ссылка при создании Розничного возврата обязательно должна быть активной.
При создании Розничного возврата через JSON API, дата, указанная в **moment** возврата
должна быть позже даты, указанной в **moment** активной розничной смены, иначе
произойдёт ошибка.
Обязательные поля при создании нового Розничного возврата:
+ **name** - Номер возврата
+ **organization** - Ссылка на ваше юрлицо в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **store** - Ссылка на склад в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **demand** - Ссылка на Розничную продажу, по которой произошёл возврат в формате [Метаданных](#header-метаданные), обязательное поле только для возврата на основании
+ **retailStore** - Ссылка на точку продаж в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **retailShift** - Сссылка на Розничную смену, в рамках которой происходит возврат
+ **agent** - Ссылка на контрагента в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные).
Контрагент, указанный в запросе на создание возврата, должен совпадать с контрагентом, указанном в документе, по которому создаётся возврат.
+ **cashSum**  - Оплачено наличными. Поле является необходимым для возврата без основания
+ **noCashSum** - Оплачено картой. Поле является необходимым для возврата без основания

При создании возврата:
+ Контрагент в возврате и в документе, по которому он создаётся, должны совпадать
+ Валюта и юрлицо в возврате и в документе так же должны совпадать
+ При передаче коллекции **positions** в теле запроса на создание возврата, передаваемые позиции
должны соответствовать позициям в документе. Различие может быть только в количестве товара в позиции
(меньшее либо равное количеству в документе). Нельзя передать позиции, которых нет в документе.

> Пример создания новой Розничного возврата с телом запроса, содержащим только необходимые поля.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного Розничного возврата.

> Пример создания нового Розничного возврата с более насыщенным телом запроса.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного Розничного возврата.

> Пример запроса на создание Розничного возврата с позициями в теле запроса.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного Розничного возврата.

> Пример запроса на создание Розничного возврата без основания.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданного Розничного возврата.

### Массовое создание и обновление Розничных возвратов 
[Массовое создание и обновление](/api/remap/1.2/doc/index.html#header-создание-и-обновление-нескольких-объектов) Розничных возвратов.
В теле запроса нужно передать массив, содержащий JSON представления Розничных возвратов, которые вы хотите создать или обновить.
Обновляемые Розничные возвраты должны содержать идентификатор в виде метаданных.

> Пример создания и обновления нескольких Розничных возвратов

> Response 200 (application/json)
Успешный запрос. Результат - массив JSON представлений созданных и обновленных Розничных возвратов.

### Удалить Розничный возврат

**Параметры**

|Параметр   |Описание   | 
|---|---|
|   id|   `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Розничного возврата|
 
> Запрос на удаление Розничного возврата с указанным id.

> Response 200 (application/json)
Успешное удаление Розничного возврата.

### Метаданные Розничных возвратов 
#### Метаданные Розничных возвратов 
Запрос на получение метаданных Розничных возвратов. Результат - объект JSON, включающий в себя:
+ **meta** - Ссылка на метаданные Розничных возвратов
+ **attributes** - Массив объектов доп. полей Розничных возвратов в формате [Метаданных](/api/remap/1.2/doc/index.html#header-метаданные)
+ **states** - Массив статусов Розничных возвратов
+ **createShared** - создавать новые Розничные возвраты с меткой "Общий"

Структура отдельного объекта, представляющего доп. поле подробно описана в разделе [Работа с дополнительными полями](/api/remap/1.2/doc/index.html#header-работа-с-дополнительными-полями).

> Метаданные Розничных возвратов

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление доп. полей Розничных возвратов.

### Отдельное доп. поле

**Параметры**

|Параметр   |Описание   | 
|---|---|
|   id|   `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Доп. поля|
  
#### Отдельное доп. поле 
> Запрос на получение информации по отдельному дополнительному полю.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление отдельного доп. поля.

### Шаблон розничного возврата 
#### Шаблон розничного возврата на основе 
Запрос на получение предзаполненого стандартными значениями
шаблона розничного возврата на основе других документов.
Шаблон розничного возврата можно получить на основе:
+ Розничной смены
+ Розничной продажи

При запросе шаблона только с розничной сменой в результате получиться шаблон возврата без основания.
При запросе шаблона с указанием розничной продажи, розничная смена может быть заполнена из неё.

> Пример запроса на создание шаблона розничного возврата на основе смены.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление предзаполненного розничного возврата.

> Пример запроса на создание шаблона розничного возврата на основе розничной продажи.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление предзаполненного розничного возврата.

### Розничный возврат

**Параметры**

|Параметр   |Описание   | 
|---|---|
|   id|   `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id розничного возврата|
   
### Получить Розничный возврат 
> Запрос на получение отдельного Розничного возврата с указанным id.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление Розничного возврата с указанным id.

### Изменить Розничный возврат 
Запрос на обновление Розничного возврата с указанным id.
В теле запроса можно указать только те поля, которые необходимо изменить у Розничного возврата, кроме тех, что
помечены `Только для чтения` в описании [атрибутов Розничного возврата](#документ-розничный-возврат-розничные-возвраты).
При обновлении поля **organization** нужно также обновить поле **organizationAccount** иначе произойдёт ошибка.

Контрагент должен совпадать с контрагентом, указанным в документе, по которому создаётся возврат.

При обновлении возврата:
+ Нельзя изменять следующие поля: **agentAccount**, **agent**, **demand**
+ Нельзя выставить валюту отличную от валюты в документе
+ Нельзя добавить позиции, отсутствующие среди позиций документа.

> Пример запроса на обновление Розничного возврата.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённого Розничного возврата.
 
### Позиции Розничного возврата 
Отдельный ресурс для управления позициями Розничного возврата. С его помощью вы можете управлять позициями большого документа, количество строк в котором превышает лимит на количество строк, сохраняемых вместе с документом. Этот лимит равен 100. Более подробно о лимитах на количество строк документа и работе с большими документами можно прочитать [тут](/api/remap/1.2/doc/index.html#header-работа-с-позициями-документов).

**Параметры**

|Параметр   |Описание   | 
|---|---|
|   id|   `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Розничного возврата|

### Получить Позиции 
Запрос на получение списка всех позиций данной Розничного возврата.
- **meta** [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о выдаче,
- **context** - [Метаданные](/api/remap/1.2/doc/index.html#header-метаданные) о сотруднике, выполнившем запрос.
- **rows** - Массив JSON объектов, представляющих собой позиции Розничного возврата.

**Параметры**

| Параметр                | Описание  |
| ------------------------------ |:---------------------------|
|limit |  `number` (optional) **Default: 1000** *Example: 1000* Максимальное количество сущностей для извлечения.`Допустимые значения 1 - 1000`.|
|offset |  `number` (optional) **Default: 0** *Example: 40* Отступ в выдаваемом списке сущностей.|

> Получить Позиции 

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление списка позиций Розничного возврата.

### Создать Позицию 
Запрос на создание новой позиции в Розничном возврате.
Для успешного создания необходимо в теле запроса указать следующие поля:
+ **assortment** - Ссылка на товар/услугу/серию/модификацию, которую представляет собой позиция.
Также можно указать поле с именем **service**, **consignment**, **variant** в соответствии с тем,
чем является указанная позиция. Подробнее об этом поле можно прочитать в описании [позиции Розничного возврата](#header-позиции-розничного-возврата).
+ **quantity** - Количество указанной позиции. Должно быть положительным, иначе возникнет ошибка.
Одновременно можно создать как одну так и несколько позиций Розничного возврата. Все созданные данным запросом позиции
будут добавлены к уже существующим.
Нельзя создавать позиции, отличные от позиций в документе, по которому создаётся возврат. Допустимо только
отличие в **quantity** позиций (количество в позиции в возврате м.б. меньше или равно количеству в позиции в документе).

> Пример запроса на создание позиций в Розничном возврате.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление созданных позиций.

### Позиция Розничного возврата

**Параметры**

|Параметр   |Описание   | 
|---|---|
|   id|   `7944ef04-f831-11e5-7a69-971500188b19` (required, string) - id Розничного возврата|
|   positionID|   `34f6344f-015e-11e6-9464-e4de0000006c` (required, string) - id позиции Розничного возврата|
   
### Получить Позицию 
> Запрос на получение отдельной позиции Розничного возврата с указанным id.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление отдельной позиции Розничного возврата.
        
### Изменить Позицию 
Запрос на обновление отдельной позиции Розничного возврата.
При обновлении отдельной позиции в возврате можно только изменить количество данной позиции.
Причём это количество должно быть в пределах , где n - кол-во данной позиции в документе, по которому создан возврат.

> Пример запроса на обновление отдельной позиции в Розничном возврате.

> Response 200 (application/json)
Успешный запрос. Результат - JSON представление обновлённой позиции Розничного возврата.

### Удалить позицию 
> Запрос на удаление отдельной позиции Розничного возврата с указанным id.

> Response 200 (application/json)
Успешное удаление позиции Розничного возврата.
